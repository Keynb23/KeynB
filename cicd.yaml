# Workflow name that appears in GitHub Actions tab
name: CI/CD Pipeline

# Controls when the workflow should run
on:
  push:
    branches:
      - main # Run when changes are pushed to the main branch
  pull_request:
    branches:
      - main # Run when a pull request is opened/updated against main

# A workflow run is made up of one or more jobs
jobs:
  # The Continuous Integration (CI) job
  ci:
    name: Code Quality Checks
    runs-on: ubuntu-latest

    steps:
      - name: ‚¨áÔ∏è Checkout Repository
        uses: actions/checkout@v4

      - name: ‚öôÔ∏è Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20' # Use your project's Node version

      - name: üì¶ Install Dependencies
        run: npm install

      # Example: Run linting checks
      - name: üîç Run Lint
        run: npm run lint # Assuming you have a "lint" script in package.json

      # Example: Run unit tests
      - name: üß™ Run Tests
        run: npm test -- --coverage --watchAll=false # Assuming you have a "test" script

  # The Continuous Deployment (CD) job
  cd:
    name: Vercel Deployment
    runs-on: ubuntu-latest
    needs: ci # This job only runs if the 'ci' job passes
    if: github.ref == 'refs/heads/main' # Only deploy on push to main

    steps:
      - name: ‚¨áÔ∏è Checkout Repository
        uses: actions/checkout@v4
      
      - name: üöÄ Deploy to Vercel
        # Uses the community Vercel action to deploy the project
        uses: amondnet/vercel-action@v25
        with:
          # VERCEL_TOKEN environment variable (references your GitHub secret)
          vercel-token: ${{ secrets.VC_PORT_SECRET }} 
          
          # VERCEL_ORG_ID and VERCEL_PROJECT_ID are required for this action 
          # to deploy correctly to a specific Vercel project/organization.
          # You must get these values from your Vercel project settings and 
          # add them to your GitHub secrets.
          vercel-org-id: ${{ secrets.VERCEL_ORG_ID }} 
          vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}
          
          # The production flag tells Vercel this is the main deployment
          vercel-args: '--prod'
          
          # Sets the build directory (optional, but good practice for Vite/React)
          working-directory: './' 
